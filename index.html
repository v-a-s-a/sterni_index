<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <!-- Following leaflet quickstart: http://leafletjs.com/examples/quick-start/-->

        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
        integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin=""/>

        <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
        integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
        crossorigin=""></script>

        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="L.D3SvgOverlay.min.js"></script>

        <script src="https://d3js.org/d3-color.v1.min.js"></script>
        <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <script src="https://d3js.org/d3-scale.v2.min.js"></script>

        <!-- http://bl.ocks.org/d3noob/7654694 -->
        <style>
            body {
                padding: 0;
                margin: 0;
            }
            html, body, #mapid {
                height: 100%;
                width: 100%;
            }
        </style>

    </head>
    <body>

        <div id="mapid"></div>
        
        <script>

            var map = L.map('mapid').setView([52.506955, 13.407455], 11);
        
            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery  <a href="http://mapbox.com">Mapbox</a>',
                id: 'mapbox.streets'
            }).addTo(map);

            // Add color scale with legend
            // http://bl.ocks.org/wrobstory/5609856
            var legend = L.control({position: 'bottomleft'});

            legend.onAdd = function (map) {var div = L.DomUtil.create('div', 'legend'); return div};

            legend.addTo(map);

            var color = d3.scale.threshold()
                    .domain([0, 2, 4, 6, 8, 10])
                    .range(['#EDF8FB', '#BFD3E6', '#9EBCDA', '#8C96C6', '#8C6BB1', '#88419D', '#6E016B']);

            var x = d3.scale.scaleSequential(d3.interpolateReds)
            .domain([0, 10])
            .range([0, 400]);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("top")
                .tickSize(1)
                .tickValues(color.domain())

            var svg = d3.select(".legend.leaflet-control").append("svg")
                .attr("id", 'legend')
                .attr("width", 450)
                .attr("height", 40);

            var g = svg.append("g")
                .attr("class", "key")
                .attr("transform", "translate(25,16)");

            g.selectAll("rect")
                .data(color.range().map(function(d, i) {
                return {
                    x0: i ? x(color.domain()[i - 1]) : x.range()[0],
                    x1: i < color.domain().length ? x(color.domain()[i]) : x.range()[1],
                    z: d
                };
                }))
            .enter().append("rect")
                .attr("height", 10)
                .attr("x", function(d) { return d.x0; })
                .attr("width", function(d) { return d.x1 - d.x0; })
                .style("fill", function(d) { return d.z; });

            g.call(xAxis).append("text")
                .attr("class", "caption")
                .attr("y", 21)
                .text('Cost');

            // http://bl.ocks.org/xEviL/4921fff1d70f5601d159
            var shops = [];
            var sterniOverlay = L.d3SvgOverlay(function(sel, proj){

                var shopsUpd = sel.selectAll('circle').data(shops);
                shopsUpd.enter()
                    .append('circle')
                    .attr('r', 1)
                    .attr('cx',function(d){return proj.latLngToLayerPoint(d.latLng).x;})
                    .attr('cy',function(d){return proj.latLngToLayerPoint(d.latLng).y;})
                    .attr('stroke','black')
                    .attr('stroke-width', 0.1)
                    .attr('fill', function(d){return color(d.cost)});
            });

            d3.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5PIoUB3bujfpUwi2phvXx_ZecNTpRfTVGc9tq2cgsMQ5uttRxZs86p_cZ_RF9L9FrT8rTxLUNlNwF/pub?gid=939729708&single=true&output=csv",function(data){
                shops = data.map(function(d){
                    d.latLng = [+d.lat, +d.lon];
                    d.cost = +d.cost;
                    return d;
                    });
                sterniOverlay.addTo(map);
            });

        </script>

        Form: https://goo.gl/forms/A2qCu6ymOy7Hi5bT2
    </body>
</html> 